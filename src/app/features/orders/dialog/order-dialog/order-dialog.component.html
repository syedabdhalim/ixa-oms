<p-dialog [(visible)]="visible" [modal]="true" [style]="{width: '980px', maxWidth: '95vw'}" header="Create New Order" (onHide)="onCancel()">
  <form class="p-fluid dialog-form" [formGroup]="form" (ngSubmit)="onSubmit()">
    <div class="grid">
      <div class="col-12">
        <div class="section-title">Customer Information</div>
      </div>
      <div class="col-12 md:col-6">
        <label class="field-label">Customer Name *</label>
        <input pInputText class="w-full" type="text" formControlName="customerName" placeholder="Enter customer name" />
      </div>
      <div class="col-12 md:col-6">
        <label class="field-label">Phone Number *</label>
        <input pInputText class="w-full" type="text" formControlName="phoneNumber" placeholder="Enter phone number" />
      </div>
      <div class="col-12 md:col-6">
        <label class="field-label">Order Date *</label>
        <p-datepicker class="w-full" formControlName="orderDate" dateFormat="dd/mm/yy" inputId="orderDate" [showIcon]="true"></p-datepicker>
      </div>
      <div class="col-12 md:col-6">
        <label class="field-label">Delivery Address *</label>
        <input pInputText class="w-full" type="text" formControlName="deliveryAddress" placeholder="Enter delivery address" />
      </div>

      <div class="col-12 mt-3">
        <div class="section-title">Order Items</div>
      </div>

      <div class="col-12">
        <div class="items-card p-3">
          <div class="items-grid items-header text-600"> 
            <div>Product</div>
            <div>Quantity</div>
            <div>Price</div>
            <div>Subtotal</div>
            <div class="text-right">Actions</div>
          </div>

          <div formArrayName="items">
            <div class="items-grid items-row" *ngFor="let item of items.controls; let i = index" [formGroupName]="i">
              <div>
                <p-select class="w-full" formControlName="productId" [options]="productOptions" optionLabel="name" optionValue="id" placeholder="Select product" (onChange)="onSelectProduct(i)"></p-select>
              </div>
              <div>
                <p-inputNumber inputStyleClass="w-full" formControlName="quantity" [min]="1" [useGrouping]="false"></p-inputNumber>
              </div>
              <div>
                <p-inputNumber inputStyleClass="w-full" formControlName="price" mode="currency" currency="MYR" currencyDisplay="symbol" locale="ms-MY" [min]="0"></p-inputNumber>
              </div>
              <div class="subtotal">{{ getItemSubtotal(i) | currency:'MYR':'RM' }}</div>
              <div class="actions">
                <button type="button" pButton icon="pi pi-trash" class="p-button-text p-button-danger" (click)="removeItem(i)"></button>
              </div>
            </div>
          </div>

          <div class="mt-2">
            <button type="button" pButton icon="pi pi-plus" label="Add Item" class="p-button-text" (click)="addItem()"></button>
          </div>
        </div>
      </div>

      <div class="col-12 mt-3">
        <div class="section-title">Payment Information</div>
      </div>
      <div class="col-12">
        <div class="payment-grid">
          <div>
            <label class="field-label">Payment Method *</label>
            <p-select class="w-full" formControlName="paymentMethod" [options]="paymentMethodOptions" optionLabel="label" optionValue="value"></p-select>
          </div>
          <div>
            <label class="field-label">Payment Status *</label>
            <p-select class="w-full" formControlName="paymentStatus" [options]="paymentStatusOptions" optionLabel="label" optionValue="value"></p-select>
          </div>
          <div>
            <label class="field-label">Total Amount</label>
            <p-inputNumber inputStyleClass="w-full" formControlName="totalAmount" mode="currency" currency="MYR" currencyDisplay="symbol" locale="ms-MY" [readonly]="true"></p-inputNumber>
          </div>
        </div>
      </div>
    </div>

    <div class="flex justify-content-end gap-2 mt-4">
      <button type="button" pButton label="Cancel" class="p-button-text" (click)="onCancel()"></button>
      <button type="submit" pButton label="Create Order" class="p-button-primary" [disabled]="form.invalid"></button>
    </div>
  </form>
</p-dialog>



